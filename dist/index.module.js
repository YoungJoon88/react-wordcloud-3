import t from"lodash.debounce";import n,{useRef as r,useState as e,useEffect as o}from"react";import{select as i,event as a}from"d3-selection";import s from"resize-observer-polyfill";import"d3-transition";import{range as l,min as u,max as c,descending as f}from"d3-array";import d from"d3-cloud";import h from"lodash.clonedeep";import m from"lodash.isempty";import y from"seedrandom";import p from"tippy.js";import{dispatch as v}from"d3-dispatch";import{scaleOrdinal as x,scaleLinear as g,scaleSqrt as b,scaleLog as w}from"d3-scale";import{schemeCategory10 as M}from"d3-scale-chromatic";function z(){return(z=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e])}return t}).apply(this,arguments)}var W=Math.PI/180;function k(t){return t.text}function S(){return"serif"}function O(){return"normal"}function T(t){return Math.sqrt(t.value)}function j(){return 30*(~~(6*Math.random())-3)}function q(){return 1}function A(t,n,r,e){if(!n.sprite){var o=t.context,i=t.ratio;o.clearRect(0,0,2048/i,2048/i);var a=0,s=0,l=0,u=r.length;for(--e;++e<u;){n=r[e],o.save(),o.font=n.style+" "+n.weight+" "+~~((n.size+1)/i)+"px "+n.font;var c=o.measureText(n.text+"m").width*i,f=n.size<<1;if(n.rotate){var d=Math.sin(n.rotate*W),h=Math.cos(n.rotate*W),m=c*h,y=c*d,p=f*h,v=f*d;c=Math.max(Math.abs(m+v),Math.abs(m-v))+31>>5<<5,f=~~Math.max(Math.abs(y+p),Math.abs(y-p))}else c=c+31>>5<<5;if(f>l&&(l=f),a+c>=2048&&(a=0,s+=l,l=0),s+f>=2048)break;o.translate((a+(c>>1))/i,(s+(f>>1))/i),n.rotate&&o.rotate(n.rotate*W),o.fillText(n.text,0,0),n.padding&&(o.lineWidth=2*n.padding,o.strokeText(n.text,0,0)),o.restore(),n.width=c,n.height=f,n.xoff=a,n.yoff=s,n.x1=c>>1,n.y1=f>>1,n.x0=-n.x1,n.y0=-n.y1,n.hasText=!0,a+=c}for(var x=o.getImageData(0,0,2048/i,2048/i).data,g=[];--e>=0;)if((n=r[e]).hasText){for(var b=(c=n.width)>>5,w=(f=n.y1-n.y0,0);w<f*b;w++)g[w]=0;if(null==(a=n.xoff))return;s=n.yoff;for(var M=0,z=-1,k=0;k<f;k++){for(w=0;w<c;w++){var S=x[2048*(s+k)+(a+w)<<2]?1<<31-w%32:0;g[b*k+(w>>5)]|=S,M|=S}M?z=k:(n.y0++,f--,k--,s++)}n.y1=n.y0+z,n.sprite=g.slice(0,(n.y1-n.y0)*b)}}}function I(t,n,r){for(var e,o=t.sprite,i=t.width>>5,a=t.x-(i<<4),s=127&a,l=32-s,u=t.y1-t.y0,c=(t.y+t.y0)*(r>>=5)+(a>>5),f=0;f<u;f++){e=0;for(var d=0;d<=i;d++)if((e<<l|(d<i?(e=o[f*i+d])>>>s:0))&n[c+d])return!0;c+=r}return!1}function E(t,n){var r=t[0],e=t[1];n.x+n.x0<r.x&&(r.x=n.x+n.x0),n.y+n.y0<r.y&&(r.y=n.y+n.y0),n.x+n.x1>e.x&&(e.x=n.x+n.x1),n.y+n.y1>e.y&&(e.y=n.y+n.y1)}function C(t){var n=t[0]/t[1];return function(t){return[n*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function D(){return document.createElement("canvas")}function F(t){return"function"==typeof t?t:function(){return t}}var R={archimedean:C,rectangular:function(t){var n=4*t[0]/t[1],r=0,e=0;return function(t){var o=t<0?-1:1;switch(Math.sqrt(1+4*o*t)-o&3){case 0:r+=n;break;case 1:e+=4;break;case 2:r-=n;break;default:e-=4}return[r,e]}}};function P(t,n){return t[Math.floor(n()*t.length)]}function H(t){return t.size+"px"}function L(t){return t.text}function N(t){return"translate("+t.x+", "+t.y+")"+("number"==typeof t.rotate?"rotate("+t.rotate+")":"")}function U(t){var n,r=t.callbacks,e=t.maxWords,o=t.options,i=t.selection,s=t.size,l=t.activeWords,x=o.deterministic,M=o.enableOptimizations,W=o.fontFamily,U=o.fontStyle,V=o.fontSizes,B=o.fontWeight,G=o.padding,J=o.randomSeed,K=o.rotations,Q=o.rotationAngles,X=o.spiral,Y=o.scale,Z=t.words.concat().sort(function(t,n){return f(t.value,n.value)}).slice(0,e),$=y(x?J||"deterministic":null);(n=M?function(){var t=[256,256],n=k,r=S,e=T,o=O,i=O,a=j,s=q,l=C,u=[],c=Infinity,f=v("word","end"),d=Math.random,h={},m=D,y=!1;function p(n,r,e){for(var o,i,a,s,u,c=r.x,f=r.y,h=Math.sqrt(t[0]*t[0]+t[1]*t[1]),m=l(t),y=d()<.5?1:-1,p=-y;(o=m(p+=y))&&(i=~~o[0],a=~~o[1],!(Math.min(Math.abs(i),Math.abs(a))>=h));)if(r.x=c+i,r.y=f+a,!(r.x+r.x0<0||r.y+r.y0<0||r.x+r.x1>t[0]||r.y+r.y1>t[1]||e&&I(r,n,t[0])||e&&!((s=r).x+s.x1>(u=e)[0].x&&s.x+s.x0<u[1].x&&s.y+s.y1>u[0].y&&s.y+s.y0<u[1].y))){for(var v,x=r.sprite,g=r.width>>5,b=t[0]>>5,w=r.x-(g<<4),M=127&w,z=32-M,W=r.y1-r.y0,k=(r.y+r.y0)*b+(w>>5),S=0;S<W;S++){v=0;for(var O=0;O<=g;O++)n[k+O]|=v<<z|(O<g?(v=x[S*g+O])>>>M:0);k+=b}return delete r.sprite,!0}return!1}return h.canvas=function(t){return arguments.length?(m=F(t),h):m},h.start=function(){var l=function(t){t.width=t.height=1;var n=Math.sqrt(t.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,1,1).data.length>>2);t.width=2048/n,t.height=2048/n;var r=t.getContext("2d",{willReadFrequently:!0});return r.fillStyle=r.strokeStyle="red",r.textAlign="center",{context:r,ratio:n}}(m()),c=new Uint32Array((t[0]>>5)*t[1]),v=null,x=[],g=u.map(function(t,l){return t.text=n.call(this,t,l),t.font=r.call(this,t,l),t.style=o.call(this,t,l),t.weight=i.call(this,t,l),t.rotate=a.call(this,t,l),t.size=~~e.call(this,t,l),t.padding=s.call(this,t,l),t}).sort(function(t,n){return n.size-t.size});return setTimeout(function(){return function n(r){var e=50*r,o=Math.min(50*(r+1),u.length);!function(n,r){for(var e=n;e<r;e+=1){var o=g[e];o.x=t[0]*(d()+.5)>>1,o.y=t[1]*(d()+.5)>>1,A(l,o,g,e),o.hasText&&p(c,o,v)&&(x.push(o),f.call("word",h,o),v?E(v,o):v=[{x:o.x+o.x0,y:o.y+o.y0},{x:o.x+o.x1,y:o.y+o.y1}],o.x-=t[0]>>1,o.y-=t[1]>>1)}}(e,o),y||(o<u.length?setTimeout(function(){return n(r+1)},0):(h.stop(),f.call("end",h,x,v)))}(0)},0),h},h.revive=function(){return y=!1,h},h.stop=function(){return y=!0,h},h.timeInterval=function(t){return arguments.length?(c=null==t?Infinity:t,h):c},h.words=function(t){return arguments.length?(u=t,h):u},h.size=function(n){return arguments.length?(t=[+n[0],+n[1]],h):t},h.font=function(t){return arguments.length?(r=F(t),h):r},h.fontStyle=function(t){return arguments.length?(o=F(t),h):o},h.fontWeight=function(t){return arguments.length?(i=F(t),h):i},h.rotate=function(t){return arguments.length?(a=F(t),h):a},h.text=function(t){return arguments.length?(n=F(t),h):n},h.spiral=function(t){return arguments.length?(l=R[t]||t,h):l},h.fontSize=function(t){return arguments.length?(e=F(t),h):e},h.padding=function(t){return arguments.length?(s=F(t),h):s},h.random=function(t){return arguments.length?(d=t,h):d},h.on=function(){var t=f.on.apply(f,arguments);return t===f?h:t},h}():d()).size(s).padding(G).words(h(Z)).rotate(function(){return void 0===K?30*(~~(6*$())-3):function(t,n,r){if(t<1)return 0;var e=[];if(1===t)e=[n[0]];else{e=[].concat(n);for(var o=(n[1]-n[0])/(t-1),i=n[0]+o;i<n[1];)e.push(i),i+=o}return P(e,r)}(K,Q,$)}).spiral(X).random($).text(L).font(W).fontStyle(U).fontWeight(B),function t(e,s){void 0===s&&(s=1),M&&n.revive(),n.fontSize(function(t){return function(t,n,r){var e,o=u(t,function(t){return Number(t.value)}),i=c(t,function(t){return Number(t.value)});switch(r){case"log":e=w;break;case"sqrt":e=b;break;case"linear":default:e=g}return e().domain([o,i]).range(n)}(Z,e,Y)(t.value)}).on("end",function(n){if(Z.length!==n.length&&s<=10){10===s&&console.warn("Unable to layout "+(Z.length-n.length)+" word(s) after "+s+" attempts.  Consider: (1) Increasing the container/component size. (2) Lowering the max font size. (3) Limiting the rotation angles.");var u=Math.max(.95*e[0],1);t([u,Math.max(.95*e[1],u)],s+1)}else!function(t){var n,r=t.callbacks,e=t.options,o=t.random,i=t.words,s=t.activeWords,l=r.getWordColor,u=r.getWordTooltip,c=r.onWordClick,f=r.onWordMouseOver,d=r.onWordMouseOut,h=e.colors,y=e.enableTooltip,v=e.fontStyle,x=e.fontWeight,g=e.textAttributes,b=e.tooltipOptions,w=e.fontFamily,M=e.transitionDuration;function W(t){return!m(s)&&s.includes(t.text)?"active":"in-active"}function k(t){return l?l(t):P(h,o)}t.selection.selectAll("text").data(i).join(function(t){var r=t.append("text").on("click",function(t){c&&c(t,a)}).on("mouseover",function(t){!y||n&&!n.isDestroyed||(n=p(a.target,z({animation:"scale",arrow:!0,content:function(){return u(t)},onHidden:function(t){t.destroy(),n=null}},b))),f&&f(t,a)}).on("mouseout",function(t){n&&!n.state.isVisible&&n.destroy(),d&&d(t,a)}).attr("cursor",c?"pointer":"default").attr("fill",k).attr("font-family",w).attr("font-style",v).attr("font-weight",x).attr("text-anchor","middle").attr("transform","translate(0, 0) rotate(0)");"object"==typeof g&&Object.keys(g).forEach(function(t){r=r.attr(t,g[t])}),r=r.call(function(t){return t.transition().duration(M).attr("class",W).attr("font-size",H).attr("transform",N).text(L)})},function(t){t.transition().duration(M).attr("class",W).attr("fill",k).attr("font-family",w).attr("font-size",H).attr("transform",N).text(L)},function(t){t.transition().duration(M).attr("fill-opacity",0).remove()})}({callbacks:r,options:o,random:$,selection:i,words:n,activeWords:l})}).start()}(V)}var V=["callbacks","maxWords","minSize","options","size","words","activeWords"],B={getWordTooltip:function(t){return t.text+" ("+t.value+")"}},G={colors:l(20).map(function(t){return t.toString()}).map(x(M)),deterministic:!1,enableOptimizations:!1,enableTooltip:!0,fontFamily:"times new roman",fontSizes:[4,32],fontStyle:"normal",fontWeight:"normal",padding:1,rotationAngles:[-90,90],scale:"sqrt",spiral:"rectangular",tooltipOptions:{},transitionDuration:600};function J(a){var l=a.callbacks,u=a.maxWords,c=void 0===u?100:u,f=a.minSize,d=a.options,h=a.size,m=a.words,y=a.activeWords,p=function(t,n){if(null==t)return{};var r,e,o={},i=Object.keys(t);for(e=0;e<i.length;e++)n.indexOf(r=i[e])>=0||(o[r]=t[r]);return o}(a,V),v=function(t,n,a){var l=r(),u=e(n),c=u[0],f=u[1],d=e(null),h=d[0],m=d[1];return o(function(){var r=l.current,e=i(r).append("svg").style("display","block");"object"==typeof a&&Object.keys(a).forEach(function(t){e=e.attr(t,a[t])});var o=e.append("g");function u(t,n){e.attr("height",n).attr("width",t),o.attr("transform","translate("+t/2+", "+n/2+")"),f([t,n])}m(o);var c=0,d=0;void 0===n?(c=r.parentElement.offsetWidth,d=r.parentElement.offsetHeight):(c=n[0],d=n[1]),u(c=Math.max(c,t[0]),d=Math.max(d,t[1]));var h=new s(function(t){if(t&&0!==t.length&&void 0===n){var r=t[0].contentRect;u(r.width,r.height)}});return h.observe(r),function(){h.unobserve(r),i(r).selectAll("*").remove()}},[n,t,a]),[l,h,c]}(f,h,d.svgAttributes),x=v[0],g=v[1],b=v[2],w=r(t(U,100));return o(function(){if(g){var t=z({},B,l),n=z({},G,d);w.current({callbacks:t,maxWords:c,options:n,selection:g,size:b,words:m,activeWords:y})}},[c,l,d,g,b,m,y]),n.createElement("div",z({ref:x,style:{height:"100%",width:"100%"}},p))}J.defaultProps={callbacks:B,maxWords:100,minSize:[300,300],options:G};export default J;export{B as defaultCallbacks,G as defaultOptions};
//# sourceMappingURL=index.module.js.map
